<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Soundboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2d89ef">
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
      background: #f0f0f0;
    }

    h1 {
      margin-bottom: 20px;
    }

    .button-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
    }

    .sound-control {
      display: flex;
      flex-wrap: nowrap;
      gap: 10px;
      width: 100%;
      max-width: 400px;
    }

    .sound-control button {
      flex: 1;
      padding: 16px;
      font-size: 20px;
      border: none;
      border-radius: 8px;
      background: #2d89ef;
      color: white;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .sound-control button:hover {
      background: #1e5fbd;
    }

    .sound-control button:first-child {
      flex: 2;
    }

    .sound-control button:last-child {
      flex: 1;
    }
  </style>
</head>

<body>

  <div class="button-grid" id="soundboard-container"></div>

  <button id="install-button" style="display: none;">Install as app</button>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }

    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (event) => {
      // Prevent the default prompt from showing
      event.preventDefault();
      // Save the event to show later
      deferredPrompt = event;

      // Show your custom install prompt (e.g., a button)
      // For example:
      const installButton = document.getElementById('install-button');
      installButton.style.display = 'block';

      installButton.addEventListener('click', () => {
        // Show the prompt
        deferredPrompt.prompt();
        // Wait for the user to respond to the prompt
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('User accepted the A2HS prompt');
          } else {
            console.log('User dismissed the A2HS prompt');
          }
          deferredPrompt = null;
        });
      });
    });

    const sounds = {
      'eat.mp3': '🍽️ Eat',
      'bell-notification-337658.mp3': '🐦 Play', // https://pixabay.com/sound-effects/bell-notification-337658/
      // 'outdoors.mp3': '☀️ Outdoors'
    };

    const soundboardContainer = document.getElementById('soundboard-container');

    for (const [file, label] of Object.entries(sounds)) {
      const soundControlDiv = document.createElement('div');
      soundControlDiv.classList.add('sound-control');

      const playButton = document.createElement('button');
      playButton.textContent = label;
      playButton.onclick = () => playSound(`sounds/${file}`);
      soundControlDiv.appendChild(playButton);

      const loopButton = document.createElement('button');
      loopButton.textContent = '🔁';
      loopButton.onclick = () => toggleLoop(file, `sounds/${file}`);
      soundControlDiv.appendChild(loopButton);

      soundboardContainer.appendChild(soundControlDiv);
    }

    function playSound(file) {
      new Audio(file).play();
    }

    const loopingSounds = {};

    function toggleLoop(key, file) {
      if (loopingSounds[key]) {
        loopingSounds[key].pause();
        loopingSounds[key].currentTime = 0;
        delete loopingSounds[key];
      } else {
        const audio = new Audio(file);
        audio.loop = true;
        audio.play();
        loopingSounds[key] = audio;
      }
    }
  </script>

</body>

</html>